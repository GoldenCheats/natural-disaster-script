local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local lp = Players.LocalPlayer

local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TopBar = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseBtn = Instance.new("TextButton")
local MinimizeBtn = Instance.new("TextButton")

local DeviceScreen = Instance.new("Frame")
local HomeScreen = Instance.new("Frame")
local ScriptScreen = Instance.new("ScrollingFrame")

-- State Control
local FakePosEnabled = false
local FallBreakerEnabled = false
local HealthMultEnabled = false
local God2018Active = false
local SAFE_OFFSET = Vector3.new(0, 5, 0)
local lastSafeCF = CFrame.new()

-- [[ DRAG LOGIC - MULTI-SIDE GRAB ]]
local function makeDraggable(frame)
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then update(input) end
    end)
end

-- [[ GODMODE LOGIC ]]
local function apply2018GodMode()
    local char = lp.Character or lp.CharacterAdded:Wait()
    local oldHum = char:FindFirstChildOfClass("Humanoid")
    if oldHum then
        oldHum:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
        local newHum = oldHum:Clone()
        newHum.Name = "Humanoid"
        newHum.Parent = char
        workspace.CurrentCamera.CameraSubject = newHum
        oldHum.Name = "OldHumanoid"
        oldHum:Destroy()
        local animate = char:FindFirstChild("Animate")
        if animate then
            animate.Disabled = true
            RunService.Stepped:Wait()
            animate.Disabled = false
        end
    end
end

lp.CharacterAdded:Connect(function()
    if God2018Active then task.wait(0.5) apply2018GodMode() end
end)

-- [[ UI INITIALIZATION ]]
ScreenGui.Name = "Gemini_Universal"
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 380, 0, 520) -- Default PC
MainFrame.Active = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 16)
local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = Color3.fromRGB(50, 50, 50)
MainStroke.Thickness = 2.5

makeDraggable(MainFrame)

-- Top Bar
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundTransparency = 1
TopBar.Size = UDim2.new(1, 0, 0, 50)

Title.Parent = TopBar
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0.06, 0, 0, 0)
Title.Size = UDim2.new(0.6, 0, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "GEMINI HUB V6"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18

CloseBtn.Parent = TopBar
CloseBtn.Position = UDim2.new(0.88, 0, 0.25, 0)
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseBtn.Text = ""
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(1, 0)

MinimizeBtn.Parent = TopBar
MinimizeBtn.Position = UDim2.new(0.78, 0, 0.25, 0)
MinimizeBtn.Size = UDim2.new(0, 24, 0, 24)
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
MinimizeBtn.Text = ""
Instance.new("UICorner", MinimizeBtn).CornerRadius = UDim.new(1, 0)

-------------------------------------------------------------------
-- DEVICE SELECTION SCREEN
-------------------------------------------------------------------
DeviceScreen.Name = "DeviceScreen"
DeviceScreen.Parent = MainFrame
DeviceScreen.BackgroundTransparency = 1
DeviceScreen.Size = UDim2.new(1, 0, 1, -50)
DeviceScreen.Position = UDim2.new(0, 0, 0, 50)

local DeviceLayout = Instance.new("UIListLayout", DeviceScreen)
DeviceLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
DeviceLayout.VerticalAlignment = Enum.VerticalAlignment.Center
DeviceLayout.Padding = UDim.new(0, 20)

local function CreateDeviceBtn(text, sizeData)
    local btn = Instance.new("TextButton", DeviceScreen)
    btn.Size = UDim2.new(0.7, 0, 0, 50)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.Text = text
    btn.Font = Enum.Font.GothamBold
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 16
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)
    
    btn.MouseButton1Click:Connect(function()
        MainFrame.Size = sizeData
        DeviceScreen.Visible = false
        HomeScreen.Visible = true
    end)
end

CreateDeviceBtn("PC VERSION", UDim2.new(0, 380, 0, 520))
CreateDeviceBtn("MOBILE VERSION", UDim2.new(0, 280, 0, 350))

-------------------------------------------------------------------
-- HOME SCREEN (CAUTION & TIPS)
-------------------------------------------------------------------
HomeScreen.Name = "HomeScreen"
HomeScreen.Parent = MainFrame
HomeScreen.BackgroundTransparency = 1
HomeScreen.Size = UDim2.new(1, 0, 1, -60)
HomeScreen.Position = UDim2.new(0, 0, 0, 60)
HomeScreen.Visible = false

local HomeLayout = Instance.new("UIListLayout", HomeScreen)
HomeLayout.Padding = UDim.new(0, 10)
HomeLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function CreateInfoBox(title, text, color)
    local Box = Instance.new("Frame", HomeScreen)
    Box.Size = UDim2.new(0.9, 0, 0, 110)
    Box.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    Instance.new("UICorner", Box).CornerRadius = UDim.new(0, 10)
    Instance.new("UIStroke", Box).Color = color
    
    local T = Instance.new("TextLabel", Box)
    T.Text = "⚠️ " .. title
    T.TextColor3 = color
    T.Font = Enum.Font.GothamBold
    T.TextSize = 14
    T.Size = UDim2.new(1, 0, 0, 30)
    T.BackgroundTransparency = 1
    
    local C = Instance.new("TextLabel", Box)
    C.Text = text
    C.TextColor3 = Color3.fromRGB(200, 200, 200)
    C.Font = Enum.Font.GothamMedium
    C.TextSize = 11
    C.Size = UDim2.new(1, -20, 1, -35)
    C.Position = UDim2.new(0, 10, 0, 30)
    C.BackgroundTransparency = 1
    C.TextWrapped = true
end

CreateInfoBox("CAUTION", "None of these protect against disasters. Walk fling may not work.", Color3.fromRGB(255, 80, 80))
CreateInfoBox("TIPS", "Use normal Fling. Don't jump from high buildings with Fake Position.", Color3.fromRGB(80, 180, 255))

local ProceedBtn = Instance.new("TextButton", HomeScreen)
ProceedBtn.Size = UDim2.new(0.9, 0, 0, 40)
ProceedBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ProceedBtn.Text = "PROCEED"
ProceedBtn.Font = Enum.Font.GothamBold
ProceedBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", ProceedBtn).CornerRadius = UDim.new(0, 8)

-------------------------------------------------------------------
-- SCRIPT SCREEN
-------------------------------------------------------------------
ScriptScreen.Name = "ScriptScreen"
ScriptScreen.Parent = MainFrame
ScriptScreen.BackgroundTransparency = 1
ScriptScreen.Size = UDim2.new(1, 0, 1, -70)
ScriptScreen.Position = UDim2.new(0, 0, 0, 65)
ScriptScreen.Visible = false
ScriptScreen.ScrollBarThickness = 0

local ScriptLayout = Instance.new("UIListLayout", ScriptScreen)
ScriptLayout.Padding = UDim.new(0, 10)
ScriptLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function AddButtonWithTip(name, subtext, callback)
    local Btn = Instance.new("TextButton", ScriptScreen)
    Btn.Size = UDim2.new(0.94, 0, 0, 70)
    Btn.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    Btn.Text = ""
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 10)
    local s = Instance.new("UIStroke", Btn)
    s.Color = Color3.fromRGB(45, 45, 45)
    
    local MainText = Instance.new("TextLabel", Btn)
    MainText.Text = name
    MainText.Font = Enum.Font.GothamBold
    MainText.TextColor3 = Color3.fromRGB(255, 255, 255)
    MainText.TextSize = 14
    MainText.Position = UDim2.new(0, 12, 0, 12)
    MainText.Size = UDim2.new(1, -24, 0, 15)
    MainText.BackgroundTransparency = 1
    MainText.TextXAlignment = Enum.TextXAlignment.Left

    local SubLabel = Instance.new("TextLabel", Btn)
    SubLabel.Text = subtext
    SubLabel.Font = Enum.Font.GothamMedium
    SubLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    SubLabel.TextSize = 10
    SubLabel.Position = UDim2.new(0, 12, 0, 30)
    SubLabel.Size = UDim2.new(1, -24, 0, 30)
    SubLabel.BackgroundTransparency = 1
    SubLabel.TextXAlignment = Enum.TextXAlignment.Left
    SubLabel.TextWrapped = true

    local active = false
    Btn.MouseButton1Click:Connect(function()
        active = not active
        s.Color = active and Color3.fromRGB(0, 255, 140) or Color3.fromRGB(45, 45, 45)
        callback(active)
    end)
end

-- Logic Hookups
RunService.Heartbeat:Connect(function()
    local char = lp.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local velocity = hrp.AssemblyLinearVelocity

    if FakePosEnabled or FallBreakerEnabled then
        if Vector3.new(velocity.X, 0, velocity.Z).Magnitude > 60 then lastSafeCF = hrp.CFrame end
        if velocity.Y < -90 or velocity.Y > 90 then
            hrp.CFrame = lastSafeCF + SAFE_OFFSET
            hrp.AssemblyLinearVelocity = Vector3.zero
        end
    end

    if HealthMultEnabled then
        local currentV = hrp.AssemblyLinearVelocity
        hrp.AssemblyLinearVelocity = Vector3.zero
        RunService.RenderStepped:Wait()
        if hrp.Parent then hrp.AssemblyLinearVelocity = currentV end
    end
end)

AddButtonWithTip("Fake Position", "❌ Fling | ✅ Wins\nNo high jumping.", function(v) FakePosEnabled = v end)
AddButtonWithTip("Fall Damage Breaker v2", "❌ Fling | ✅ Wins", function(v) FallBreakerEnabled = v end)
AddButtonWithTip("Health Multipleyer", "✅ Fling | ❌ Wins", function(v) HealthMultEnabled = v end)
AddButtonWithTip("2018 Godmode", "❌ Fling | ❌ Wins", function(v) God2018Active = v if v then apply2018GodMode() end end)

ProceedBtn.MouseButton1Click:Connect(function() HomeScreen.Visible = false ScriptScreen.Visible = true end)
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
